<html>
  <head>
    <title>Address History</title>
    <link type="text/css" rel="stylesheet" href="bower_components/materialize/dist/css/materialize.min.css"  media="screen,projection"/>
    <!--     Move into css folder instead of using bower -->
    <link type="text/css" rel="stylesheet" href="custom.css"/>
    <script src="http://fb.me/react-0.12.2.js"></script>
    <script src="http://fb.me/JSXTransformer-0.12.2.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="bower_components/materialize/dist/js/materialize.min.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <script type="text/jsx">
      var AnswerMultipleChoiceQuestion = React.createClass({
        propTypes: {
          value: React.PropTypes.string,
          choices: React.PropTypes.string.isRequired,
          onCompleted: React.PropTypes.func.isRequired
        },
        getInitialState: function () {
          return {
            id: _.uniqueId('multiple-choice-'),
            value: this.props.value
          };
        },
        handleChanged: function (value) {
          this.setState({value: value});
          this.props.onCompleted(value);
        },
        renderChoices: function() {
          var arrayOfChoices = this.props.choices.split(',')
          console.log(arrayOfChoices)
          return arrayOfChoices.map(function(choice, i) {
            return <AnswerRadioInput
              id={"choice-" + i}
              name={this.state.id}
              label={choice}
              value={choice}
              checked={this.state.value === choice}
              onChanged={this.handleChanged} />
          }.bind(this));
        },
        render: function() {
          return (
            <div className="form-group">
              <label className="survey-item-label" htmlFor={this.state.id}>{this.props.label}</label>
              <div className="survey-item-content">
                  {this.renderChoices()}
              </div>
            </div>
            );
        }
      });

      var AnswerRadioInput = React.createClass({
        propTypes: {
          key: React.PropTypes.string,
          name: React.PropTypes.string.isRequired,
          label: React.PropTypes.string.isRequired,
          value: React.PropTypes.string.isRequired,
          checked: React.PropTypes.bool,
          onChanged: React.PropTypes.func.isRequired
        },
        handleChanged: function (e) {
          var checked = e.target.checked;
          this.setState({checked: checked});
          if (checked) {
            this.props.onChanged(this.props.value);
          }
        },
        getDefaultProps: function () {
          return {
            id: null,
            checked: false
          };
        },
        getInitialState: function () {
          var id = this.props.id ? this.props.id : _.uniqueId('radio-');
          return {
            checked: !!this.props.checked,
            id: id,
            name: id
          };
        },
        render: function () {
          return (
            <div className="radio">
              <label htmlFor={this.state.id}>
                <input type="radio"
                  name={this.props.name}
                  id={this.state.id}
                  checked={this.state.checked} />
                {this.props.label}
              </label>
            </div>
          );
        }
      });
      React.render(
        <AnswerMultipleChoiceQuestion choices="blue, green, yellow" />,
          document.getElementById("content")
        );
    </script>
  </body>
 </html>
